# Rustline

Jerry: A Redline Stealer.
George: Written in Rust.
Jerry: A Rusty Redline Stealer.
George: A Rusty Redline Stealer, Jerry!

**We caught a Redline variant executing on an endpoint and intercepted the encrypted files as they traversed the edge proxy. Well, everything except for the flag.txt file (imagine that...). Any chance you could figure out how this thing works and recover the flag?**

**Attachments: challenge.zip**

---

Extracting the challenge zip, we see these files:

![screenshot](https://github.com/mythemeria/ctf-writeups/blob/main/images/11112024-124726.png?raw=true)

The two folders seem to contain basically the same files, but there is an additional flag file in the encrypted files folder.

![screenshot](https://github.com/mythemeria/ctf-writeups/blob/main/images/11112024-125227.png?raw=true)

At first, I assumed the key files would be used to decrypt the encrypted files and tried adding them to my ssh keyring. This gave me an error, though. So I took a step back and tried rethinking my approach. Instead of just trying the most obvious thing, it's probably better to go for an analysic approach. I looked at the files in a hex editor and noticed that they were the same size, which you can see in the image above. This means it's very likely that the encrypted files are the challenge files after being encrypted and I am supposed to work out how to reverse the encryption to read the flag file.

The file sizes actually say a lot about the encryption method, as they are not all multiples of some number which would imply that a block cipher was used. Asymmetric encryption would produce different file sizes. So this must be something far less secure. Perhaps xor?

I wrote a script to xor an encrypted file with its plaintext self, which would retrieve the key if it is xor.

```python
with open('challenge-files/password.txt', 'rb') as fp:
  with open('encrypted-files/password.txt', 'rb') as fc:
    plain = fp.read()
    ciphertext = fc.read()
    print([int(p^c) for p, c in zip(plain, ciphertext)])
```

Which outputs `[184, 247, 47, 246, 149, 88, 119, 69, 176, 143, 220, 142, 231, 26, 223, 126, 184, 247, 47, 246, 149, 88, 119, 69, 176, 143, 220, 142, 231, 26, 223, 126, 184, 247, 47, 246, 149, 88, 119, 69, 176, 143]`

You'll note that this repeats! There's pretty much no way this isn't a keyed xor, so I wrote a script that would xor the flag file with this key:

```python
with open('encrypted-files/flag.txt', 'rb') as fc:
  cdata = fc.read()
  key = bytes([184, 247, 47, 246, 149, 88, 119, 69, 176, 143, 220, 142, 231, 26, 223, 126])
  
  plain = ''
  for c in cdata:
    plain += chr(c ^ key[len(plain) % len(key)])
  print(plain)
```

Sure enough, this prints the flag:

```
"Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt. Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem. Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur? Quis autem vel eum iure reprehenderit qui in ea voluptate velit esse quam nihil molestiae consequatur, vel illum qui dolorem eum fugiat quo voluptas nulla pariatur?"

flag{bfe12aadd139def4d47f5f51a539249d}

"Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt. Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit, sed quia non numquam eius modi tempora incidunt ut labore et dolore magnam aliquam quaerat voluptatem. Ut enim ad minima veniam, quis nostrum exercitationem ullam corporis suscipit laboriosam, nisi ut aliquid ex ea commodi consequatur? Quis autem vel eum iure reprehenderit qui in ea voluptate velit esse quam nihil molestiae consequatur, vel illum qui dolorem eum fugiat quo voluptas nulla pariatur?"
```