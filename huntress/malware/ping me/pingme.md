# Ping Me

We found this file in the autoruns of a host that seemed to have a lot of network activity... can you figure out what it was doing?

**Download the file(s) below.**

**Attachments: ping_me.vbs**

---

Opening the .vbs file, we see a very ugly one-liner:

![a very ugly line of vbs code that starts with execute and then goes off the screen](https://github.com/mythemeria/ctf-writeups/blob/main/huntress/images/without%20newlines.png?raw=true)

From first glance it seems like the chr() function is probably the same thing as it is in python, which is it takes a number and returns the corresponding ascii character. So if there's nothing else going on here, this is probably just going to decode into some command string that is then executed.

It's a bit hard to read this way so I do a fun lil trick of replacing '&chr' with '&chr\n':

![the same code from before except now the chr functions are on separate lines and you can clearly see that there is nothing else that could execute malicious instructions there](https://github.com/mythemeria/ctf-writeups/blob/main/huntress/images/with%20newlines.png?raw=true)

Sure enough, every line is just evaluated to a character so I was correct in my assumption it's just an obsfucated string. In this case, if I remove the 'execute' and run the vbs, I can see deobsfucate the script. In real malware there can sometimes be other stuff hidden in the obsfucated code that will allow it to execute malicious instructions even if you think you've removed the execution instruction so it's important to actually check.

Since I'm on linux this is a little bit annoying to run so I found [an online vbs compiler](https://www.onlinegdb.com/online_vb_compiler).

![running the vbs in the online vbs compiler](https://github.com/mythemeria/ctf-writeups/blob/main/huntress/images/vbs%20compiler.png?raw=true)

The deobsfucated command that it executes is this:

```vbs
Dim sh, ips, i:Set sh = CreateObject("WScript.Shell"):ips = Array("102.108.97.103", "123.54.100.49", "98.54.48.52", "98.98.49.98", "54.100.97.51", "50.98.56.98", "98.99.97.57", "101.50.54.100", "53.49.53.56", "57.125.35.35"):For i = 0 To UBound(ips):    sh.Run "cmd /Q /c ping " & ips(i), 0, False:Next
```

These must be the IP pinging that was mentioned in the title! But hold on, some familiarity with networking would tell you these IPs have a weird vibe. Are they perhaps ASCII instead?

```python
ips = ["102.108.97.103", "123.54.100.49", "98.54.48.52", "98.98.49.98", "54.100.97.51", "50.98.56.98", "98.99.97.57", "101.50.54.100", "53.49.53.56", "57.125.35.35"]

out = ''
for ip in ips:
  out += ''.join([chr(int(n)) for n in ip.split('.')])
  
print(out)
```

Turns out that it IS ascii because running this prints the flag.

---

Some extra notes:

* The line separation trick is actually really useful since interpreted script obsfucation often just tosses everything on one line. Most languages will have a number of characters that also serve as a good point to put a line separator, for eg ';' -> ';\n'
* I asked AI what the CLng and &H things in the VBS were because I'm unfamiliar with vbs. It turns out this is some basic math and hex respectively.
* Initially I thought I should just regex this into python, but sometimes there can be slight differences in how different languages evaluate expressions so I thought it best to just run the vbs, because while these differences are super uncommon, they're also super annoying to debug if they do exist